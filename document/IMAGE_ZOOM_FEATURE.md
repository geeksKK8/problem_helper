# 图片缩放功能实现说明

## 功能概述

在"图像预处理"模块的"剪裁图片"页面中，新增了图片缩放功能，用户可以：
- 对上传的图片进行缩放调整
- 范围框会跟随图片缩放一起缩放
- 保持范围框的相对位置不变

## 技术实现

### 1. 状态管理

```typescript
// 图片缩放控制状态
const [userScale, setUserScale] = useState(1) // 用户自定义缩放比例
const [originalImageScale, setOriginalImageScale] = useState(1) // 原始适配缩放比例
const [imageScale, setImageScale] = useState(1) // 当前实际缩放比例
```

### 2. 缩放计算逻辑

```typescript
// 计算最终缩放比例
const finalScale = originalImageScale * userScale

// 更新画布尺寸
canvas.width = image.naturalWidth * finalScale
canvas.height = image.naturalHeight * finalScale
```

### 3. 坐标系统

- **原始坐标**：基于原始图片尺寸的坐标系统
- **显示坐标**：基于缩放后画布尺寸的坐标系统
- **范围框坐标**：始终使用原始坐标，确保剪裁时使用正确的像素位置

### 4. 缩放控制

#### 缩放按钮
- **放大**：每次增加20%，最大3倍缩放
- **缩小**：每次减少20%，最小0.3倍缩放
- **重置**：恢复到100%缩放

#### 缩放范围
- 最小缩放：30% (0.3x)
- 最大缩放：300% (3x)
- 默认缩放：100% (1x)

### 5. 范围框跟随缩放

当图片缩放时，范围框会自动跟随缩放，保持：
- **相对位置不变**：范围框在图片中的相对位置保持不变
- **视觉大小同步**：范围框的显示大小与图片缩放同步
- **坐标精度**：内部坐标系统保持原始精度

## 用户界面

### 缩放控制工具栏

```
┌─────────────────────────────────────────────────────────┐
│ 缩放: [─] 100% [+] [↻]    范围框会跟随图片缩放        │
└─────────────────────────────────────────────────────────┘
```

### 功能按钮说明

- **`[─]`**：缩小按钮，减少20%缩放
- **`100%`**：当前缩放比例显示
- **`[+]`**：放大按钮，增加20%缩放
- **`[↻]`**：重置按钮，恢复到100%缩放

### 状态指示

- 按钮会根据当前缩放状态自动启用/禁用
- 缩放比例实时显示
- 提示文字说明范围框会跟随缩放

## 操作流程

### 1. 基本缩放操作

1. 用户上传图片后，系统自动计算适合的初始缩放比例
2. 用户可以使用缩放控制按钮调整图片大小
3. 图片缩放时，所有已创建的范围框会自动跟随缩放
4. 范围框的相对位置和比例保持不变

### 2. 剪裁操作

1. 用户可以在任意缩放级别下创建和编辑范围框
2. 范围框的创建、移动、缩放操作都基于当前显示尺寸
3. 完成剪裁时，系统使用原始坐标进行精确剪裁
4. 剪裁结果不受显示缩放影响

### 3. 坐标转换

```typescript
// 显示坐标转原始坐标
const originalX = displayX / imageScale
const originalY = displayY / imageScale

// 原始坐标转显示坐标
const displayX = originalX * imageScale
const displayY = originalY * imageScale
```

## 技术特点

### 1. 精确性
- 使用原始图片坐标进行最终剪裁
- 避免缩放导致的精度损失
- 保持像素级精确度

### 2. 响应性
- 实时缩放响应
- 流畅的用户体验
- 即时视觉反馈

### 3. 一致性
- 范围框与图片缩放完全同步
- 相对位置保持不变
- 操作逻辑统一

### 4. 用户友好
- 直观的缩放控制
- 清晰的状态指示
- 合理的缩放范围限制

## 使用场景

### 1. 大图片处理
- 对于高分辨率图片，可以缩小查看整体布局
- 创建大范围的选择区域

### 2. 细节调整
- 对于复杂题目，可以放大查看细节
- 精确调整范围框位置和大小

### 3. 多区域管理
- 在不同缩放级别下管理多个范围框
- 灵活调整工作视图

## 注意事项

1. **性能考虑**：缩放操作会重新计算画布尺寸，对于大图片可能需要一定时间
2. **内存使用**：高倍缩放会增加内存使用量
3. **精度保持**：所有剪裁操作都基于原始图片坐标，确保精度
4. **用户体验**：缩放范围限制在合理范围内，避免过度缩放

## 未来扩展

1. **鼠标滚轮缩放**：支持鼠标滚轮进行缩放
2. **拖拽平移**：支持拖拽移动图片位置
3. **缩放预设**：提供常用的缩放比例预设
4. **缩放历史**：记录用户的缩放操作历史 